{% macro avatar_filename(user) %}
    {% if user.avatar %}
        {{ url_for("static", filename=("img/avatars/" + user.avatar)) }}
    {% else %}
        {{ url_for("static", filename="img/default_avatar.png") }}
    {% endif %}
{% endmacro %}

{% macro article_card(article) %}
    <div class="card col-auto"
         style="margin-top: 5px; margin-bottom: 5px; padding-top: 5px; padding-bottom: 5px;">
        <h4 class="card-title">
            <img src="{{ avatar_filename(article.user) }}" alt="" width="48" height="48">
            <a href="/user_page/{{ article.author }}">@{{ article.user.nickname }}</a>
            {{ article.title }}
        </h4>
        <h6 class="card-subtitle mb-2 text-muted">Опубликовано {{ article.create_date }}</h6>
        {% if article.image %}
            <img src="{{ url_for('static', filename='img/articles_images/' + article.image) }}"
                 alt="" style="max-width: 40%" class="card-img-top">
        {% endif %}
        <div class="cart-body">
            <p class="card-text preserve-line-breaks">{{ article.content|truncate(255) }}</p>
            <a href="#" class="card-link preserve-line-breaks">Читать далее</a>
        </div>
    </div>
{% endmacro %}

{% macro pagination_widget(page_index, max_page_index, page_links_count, link_format) %}
    <ul class="pagination">
            {% if max_page_index <= page_links_count %}
                {% set min_link_index = 1 %}
                {% set max_link_index = max_page_index %}
            {% else %}
                {% if page_index <= page_links_count // 2 + 1 %}
                    {% set min_link_index = 1 %}
                    {% set max_link_index = page_links_count %}
                {% elif max_page_index - page_index + 1 <= page_links_count // 2 + 1 %}
                    {% set min_link_index = max_page_index - page_links_count + 1 %}
                    {% set max_link_index = max_page_index %}
                {% else %}
                    {% set min_link_index = page_index - page_links_count // 2 %}
                    {% set max_link_index = page_index + page_links_count // 2 %}
                {% endif %}
            {% endif %}
            {% if min_link_index > 1 %}
                <li class="page-item">
                    <a href="{{ link_format|replace('$i', '1') }}" class="page-link">First</a>
                </li>
            {% endif %}
            {% if page_index > 1 %}
                <li class="page-item">
                    <a href="{{ link_format|replace('$i', (page_index - 1)|string) }}"
                       class="page-link">&laquo;</a>
                </li>
            {% endif %}
            {% for i in range(min_link_index, max_link_index + 1) %}
                <li class="page-item {% if i == page_index %}disabled{% endif %}">
                    <a href="{{ link_format|replace('$i', i|string) }}"
                       class="page-link">{{ i }}</a>
                </li>
            {% endfor %}
            {% if page_index < max_page_index %}
                <li class="page-item">
                    <a href="{{ link_format|replace('$i', (page_index + 1)|string) }}"
                       class="page-link">&raquo;</a>
                </li>
            {% endif %}
            {% if max_link_index < max_page_index %}
                <li class="page-item">
                    <a href="{{ link_format|replace('$i', max_page_index|string) }}"
                       class="page-link">Last</a>
                </li>
            {% endif %}
        </ul>
{% endmacro %}
